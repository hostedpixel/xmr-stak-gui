<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>xmr-stak-gui</title>
  <link rel="stylesheet" href="../css/bootstrap.min.css">
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="#">xmr-stak-gui</a>
    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-collapse collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="./index.html">Home</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle active" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            Miner
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="./monitor.html">Monitor + Start/Stop</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="./miner.html">Config</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./wallet.html">Wallet</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./settings.html">Settings</a>
        </li>
      </ul>
    </div>
  </nav>
  <br>
  <div class="container-fluid">
    <h1>Miner Config</h1>
  </div>
  <div class="container">
    <form action="./monitor.html" method="GET" id="miningSettings" lpformnum="1" _lpchecked="1">
      <fieldset>
        <div class="form-group">
          <div class="custom-control custom-radio">
            <input type="radio" id="radioMonero" name="customRadio" class="custom-control-input" checked="">
            <label class="custom-control-label" for="radioMonero">Monero</label>
          </div>
          <div class="custom-control custom-radio">
            <input type="radio" id="radioAeon" name="customRadio" class="custom-control-input">
            <label class="custom-control-label" for="radioAeon">Aeon</label>
          </div>
        </div>
        <div class="form-group">
          <label for="poolAddress">Pool Address</label>
          <input type="text" required class="form-control" id="poolAddress" placeholder="pool.supportxmr.com:3333" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABHklEQVQ4EaVTO26DQBD1ohQWaS2lg9JybZ+AK7hNwx2oIoVf4UPQ0Lj1FdKktevIpel8AKNUkDcWMxpgSaIEaTVv3sx7uztiTdu2s/98DywOw3Dued4Who/M2aIx5lZV1aEsy0+qiwHELyi+Ytl0PQ69SxAxkWIA4RMRTdNsKE59juMcuZd6xIAFeZ6fGCdJ8kY4y7KAuTRNGd7jyEBXsdOPE3a0QGPsniOnnYMO67LgSQN9T41F2QGrQRRFCwyzoIF2qyBuKKbcOgPXdVeY9rMWgNsjf9ccYesJhk3f5dYT1HX9gR0LLQR30TnjkUEcx2uIuS4RnI+aj6sJR0AM8AaumPaM/rRehyWhXqbFAA9kh3/8/NvHxAYGAsZ/il8IalkCLBfNVAAAAABJRU5ErkJggg==&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
        </div>
        <div class="form-group">
          <label for="poolUsername">Username (Commonly your wallet address)</label>
          <input type="text" required class="form-control" id="poolUsername" placeholder="45fpoPTXayZ2nQtKDf7NePdmnwV3mTowN8QJZKDnUWjnV1TW3iLxu2VPHn6m7C4bYFfQkhGDKHXD5EzDNa9vH1VuEaaP2rU"
            style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABHklEQVQ4EaVTO26DQBD1ohQWaS2lg9JybZ+AK7hNwx2oIoVf4UPQ0Lj1FdKktevIpel8AKNUkDcWMxpgSaIEaTVv3sx7uztiTdu2s/98DywOw3Dued4Who/M2aIx5lZV1aEsy0+qiwHELyi+Ytl0PQ69SxAxkWIA4RMRTdNsKE59juMcuZd6xIAFeZ6fGCdJ8kY4y7KAuTRNGd7jyEBXsdOPE3a0QGPsniOnnYMO67LgSQN9T41F2QGrQRRFCwyzoIF2qyBuKKbcOgPXdVeY9rMWgNsjf9ccYesJhk3f5dYT1HX9gR0LLQR30TnjkUEcx2uIuS4RnI+aj6sJR0AM8AaumPaM/rRehyWhXqbFAA9kh3/8/NvHxAYGAsZ/il8IalkCLBfNVAAAAABJRU5ErkJggg==&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
        </div>
        <div class="form-group">
          <label for="poolPassword">Password (Commonly x or blank)</label>
          <input type="text" class="form-control" id="poolPassword" value="x" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABHklEQVQ4EaVTO26DQBD1ohQWaS2lg9JybZ+AK7hNwx2oIoVf4UPQ0Lj1FdKktevIpel8AKNUkDcWMxpgSaIEaTVv3sx7uztiTdu2s/98DywOw3Dued4Who/M2aIx5lZV1aEsy0+qiwHELyi+Ytl0PQ69SxAxkWIA4RMRTdNsKE59juMcuZd6xIAFeZ6fGCdJ8kY4y7KAuTRNGd7jyEBXsdOPE3a0QGPsniOnnYMO67LgSQN9T41F2QGrQRRFCwyzoIF2qyBuKKbcOgPXdVeY9rMWgNsjf9ccYesJhk3f5dYT1HX9gR0LLQR30TnjkUEcx2uIuS4RnI+aj6sJR0AM8AaumPaM/rRehyWhXqbFAA9kh3/8/NvHxAYGAsZ/il8IalkCLBfNVAAAAABJRU5ErkJggg==&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
        </div>
      </fieldset>
      <div class="form-group">
        <div class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input" id="TLS">
          <label class="custom-control-label" for="TLS">Does the pool support TLS encryption?</label>
        </div>
      </div>
      <div class="form-group">
        <div class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input" id="NiceHash">
          <label class="custom-control-label" for="NiceHash">Should the pool run in nicehash mode?</label>
        </div>
      </div>
      <input type="hidden" class="custom-control-input" id="start" name="start" value="true">
      <button type="submit" class="btn btn-primary">Start Miner</button>
      </fieldset>
    </form>
  </div>

  <script>
    // jQuery is weird within electron so has to be loaded like this.
    window.$ = window.jQuery = window.jquery = require("../js/jquery.min");
  </script>
  <script src="../js/popper.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>

  <script>
    // Load from gui-config.txt if it exists
    const fs = require('fs');
    const path = require('path');

    fs.readFile('./assets/configs/gui-config.txt', {
      encoding: 'utf-8'
    }, function (err, data) {
      if (!err) {
        debug('Read config file:' + data);
        debug('Filling form now');
        data = data.split(","); // Convert data string into array

        /*
          Parse the config and set form values based on the following array template:
          --currency,monero,-o,POOLADDRESS,-u,USERNAME,-p,PASSWORD,--noUAC
        */

        $("#poolAddress").val(data[3]);
        $("#poolUsername").val(data[5]);
        $("#poolPassword").val(data[7]);

        if (data[1] === "monero") {
          $("#radioMonero").prop('checked', true);
        } else {
          $("#radioAeon").prop('checked', true);
        }

        if (data[2] === "-O") {
          $("#TLS").prop('checked', true);
        } else {
          $("#TLS").prop('checked', false);
        }

        if (data[2] === "-O") {
          $("#TLS").prop('checked', true);
        } else {
          $("#TLS").prop('checked', false);
        }

        if (data[9] === "--nicehash") {
          $("#NiceHash").prop('checked', true);
        } else {
          $("#NiceHash").prop('checked', false);
        }

      } else {
        debug('Error reading gui-config.txt' + err)
      }
    });
  </script>

  <script>
    var debug = require('debug')('xmr-stak-gui-miner.html');

    $('#miningSettings').submit(function (e) {
      const realThis = this; // Used due to context changing with fs.writeFile

      e.preventDefault(); // to stop the form from submitting

      // Generate startup paramiters based on the form / loaded form
      var poolAddress = $("#poolAddress").val();
      var poolUsername = $("#poolUsername").val();
      var poolPassword = $("#poolPassword").val();

      if ($("#radioMonero").is(':checked')) {
        debug('Using Monero');
        currency = `monero`;
      } else {
        debug('Using Aeon');
        currency = `aeon`;
      }

      if ($("#TLS").is(':checked')) {
        debug('Using TLS');
        TLS = `-O`
      } else {
        debug('NOT Using TLS');
        TLS = `-o`
      }

      var config = ['--currency', currency, TLS, poolAddress, '-u', poolUsername, '-p', poolPassword, '--noUAC'];

      if ($("#NiceHash").is(':checked')) {
        debug('Using NiceHash mode');
        config.push('--nicehash');
      } else {
        debug('NOT Using NiceHash mode');
      }

      debug(config);

      fs.writeFile("gui-config.txt", config, function (err) {
        if (err) {
          return debug('Error saving config' + err);
        }

        debug('Config Saved')
        realThis.submit();
      });

    });
  </script>


</body>

</html>